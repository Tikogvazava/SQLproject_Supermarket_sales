/* 
The following Data is from Kaggle Database - Supermerket Sales. Split Data into two tables in Excel and then import these two tables into BigQuery.
Skills used: Joins, CTE's, Temp Tables, Windows Functions, Aggregate Functions, Creating Views, Converting Data Types
*/

SELECT * 
FROM sales.supermarket_sales_1
ORDER BY 2

SELECT * 
FROM sales.supermarket_sales_2
ORDER BY 8 DESC

-- Finding out the total quantity of invoices generated by each supermarket.
SELECT DISTINCT COUNT(Invoice_ID) AS Invoice_ID_count, Branch
FROM sales.supermarket_sales_2
GROUP BY Branch 
ORDER BY Invoice_ID_count ASC

-- Finding out how many invoices have been generated for female and male customers. 
SELECT COUNT(Gender) AS Purchases_by_female
FROM sales.supermarket_sales_1
WHERE Gender='Female'

SELECT COUNT(Gender) AS Purchases_by_Male
FROM sales.supermarket_sales_1
WHERE Gender='Male'

-- Finding out how many invoices have been generated by each supermarket for female and male customers who have memberships.  
SELECT COUNT(Gender) AS female_Member_count, Branch
FROM sales.supermarket_sales_1
WHERE Gender='Female' AND Customer_type='Member'
GROUP BY Branch

SELECT COUNT(Gender) AS Male_Member_count, Branch
FROM sales.supermarket_sales_1
WHERE Gender='Male' AND Customer_type='Member'
GROUP BY Branch 

-- Finding out how many invoices have been generated for Male members who have paid by Credit Card at the Branch A. 
SELECT sales_1.Invoice_ID, sales_1.Gender AS Male_Member, sales_1.Customer_type, sales_2.Payment
FROM sales.supermarket_sales_1 AS sales_1
INNER JOIN sales.supermarket_sales_2 AS sales_2 ON sales_1.Invoice_ID=sales_2.Invoice_ID
WHERE sales_1.Gender='Male' AND sales_1.Customer_type='Member' AND sales_2.Payment='Credit card'

-- Finding out how many female non-member (Normal) customers who have paid with Ewallet in city Mandalay have given the supermarket Rating 7 and above.
SELECT sales_1.Invoice_ID, sales_1.Gender AS Female_Member, sales_1.Customer_type, sales_2.Payment, sales_1.City, sales_2.Rating
FROM sales.supermarket_sales_1 AS sales_1
INNER JOIN sales.supermarket_sales_2 AS sales_2 ON sales_1.Invoice_ID=sales_2.Invoice_ID
WHERE sales_1.Gender='Female' AND sales_1.Customer_type='Normal' AND sales_2.Payment='Ewallet' AND sales_1.City='Mandalay' AND sales_2.Rating>=7
ORDER BY sales_2.Rating Desc
